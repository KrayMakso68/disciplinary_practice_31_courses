{% extends 'main/layout.html' %}
{% load static %}

{% block title %}
    Записи
{% endblock %}

{% block link %}
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/daterangepicker.css' %}" />
{% endblock %}

{% block content %}
    <h2 class="mt-4 ms-2"><a onclick="history.back();"><button class="btn btn-outline-secondary btn-circle btn-sm mb-2 me-3"><</button></a>Сводные данные</h2>

    <div id="reportrange"
         style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
        <i class="fa fa-calendar"></i>&nbsp;
        <span></span> <i class="fa fa-caret-down"></i>
    </div>


    {% if user_notes %}
    <div class="table-responsive mt-4 mx-5">
        <table class="table table-striped">
            <thead class="table-dark">
            <tr>
                <th scope="col">№</th>
                <th scope="col">Запись</th>
                <th scope="col">Кем дано</th>
                <th scope="col">Дата</th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
            {% for note in user_notes %}
                <tr>
                    <th scope="row">{{ forloop.counter }}</th>
                    <td>{{ note.type }}</td>
                    <td>{{ note.who_gave.get_FIO }}</td>
                    <td>{{ note.date|date:"d.m.Y" }}</td>
                    <td class="text-end"><a class="btn btn-sm btn-warning" href="{% url 'user_note_detail' slug=note.slug %}">Подробнее</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <div class="alert alert-warning text-center mt-4 mx-5" role="alert">
            <h4 class="mt-1">Нет записей</h4>
        </div>
    {% endif %}
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% static 'main/js/moment.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/daterangepicker.min.js' %}"></script>
    <script type="text/javascript">
        $(function () {

            var start = moment().subtract(29, 'days');
            var end = moment();

            function cb(start, end) {
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            }

            $('#reportrange').daterangepicker({
                locale: {
                    format: 'DD.MM.YYYY',
                    "applyLabel": "Ок",
                    "cancelLabel": "Отмена",
                    "fromLabel": "От",
                    "toLabel": "До",
                    "customRangeLabel": "Произвольный",
                    "daysOfWeek": [
                        "Вс",
                        "Пн",
                        "Вт",
                        "Ср",
                        "Чт",
                        "Пт",
                        "Сб"
                    ],
                    "monthNames": [
                        "Январь",
                        "Февраль",
                        "Март",
                        "Апрель",
                        "Май",
                        "Июнь",
                        "Июль",
                        "Август",
                        "Сентябрь",
                        "Октябрь",
                        "Ноябрь",
                        "Декабрь"
                    ],
                    firstDay: 1
                },
                startDate: start,
                endDate: end,
                ranges: {
                    'Сегодня': [moment(), moment()],
                    'Вчера': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Последние 7 дней': [moment().subtract(6, 'days'), moment()],
                    'Последние 30 дней': [moment().subtract(29, 'days'), moment()],
                    'Этот месяц': [moment().startOf('month'), moment().endOf('month')],
                    'Прошлый месяц': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cb);

            cb(start, end);

        });
    </script>
{% endblock %}

